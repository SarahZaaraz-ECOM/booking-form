<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>London Airport Minicab Booking</title>
    <style>
        :root {
            --primary: #111d13;
            --hover: #415d43;
        }
        body {font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 0; background: #1a1a1a; color: #333;}
        .form-container {max-width: 550px; width: 90%; margin: 10px auto; padding: 16px; background: #ffffff; border-radius: 12px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); position: relative; overflow: hidden;}
        .form-title {font-size: 32px; font-weight: 600; text-align: center; margin: 10px 0; color: #333; text-transform: uppercase; letter-spacing: 1px;}
        .form-field {display: flex; flex-direction: column; margin-bottom: 10px; box-sizing: border-box;}
        .field-label {font-size: 14px; font-weight: 500; margin-bottom: 4px; color: #333; text-transform: uppercase; display: flex; align-items: center;}
        .field-label img {width: 10px; height: 10px; margin-left: 8px; cursor: pointer; padding: 3px; border-radius: 4px; background: var(--primary);}
        .field-label img.disabled {opacity: 0.5; cursor: not-allowed;}
        .field-container {width: 100%; position: relative; display: flex; align-items: center; box-sizing: border-box;}
        .custom-input, .custom-select, .custom-datetime, .wait-time-input {
            width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 8px; font-size: 14px; background: #f5f5f5; color: #333;
            transition: border-color 0.2s ease, box-shadow 0.2s ease; box-sizing: border-box;
        }
        .custom-input:focus, .custom-select:focus, .custom-datetime:focus, .wait-time-input:focus {
            border-color: var(--primary); box-shadow: 0 0 0 3px rgba(17,29,19,0.2); outline: none;
        }
        .two-column {display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px;}
        .field-mini {gap: 6px; display: flex; align-items: center; width: 100%;}
        .wait-time-input {max-width: 80px;}
        .wait-time-input:disabled {background: #e0e0e0; cursor: not-allowed;}
        .toggle-switch {position: relative; display: inline-block; width: 40px; height: 20px; margin-left: 8px; flex-shrink: 0;}
        .toggle-switch input {opacity: 0; width: 0; height: 0;}
        .slider {position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: 0.3s; border-radius: 20px;}
        .slider:before {position: absolute; content: ""; height: 16px; width: 16px; left: 2px; bottom: 2px; background-color: white; transition: 0.3s; border-radius: 50%;}
        input:checked + .slider {background-color: var(--primary);}
        input:checked + .slider:before {transform: translateX(20px);}
        .icon-btn {background: var(--primary); border: none; padding: 6px; border-radius: 8px; cursor: pointer; margin-left: 8px; transition: background 0.2s ease; flex-shrink: 0;}
        .icon-btn:hover {background: var(--hover);}
        .icon-btn img {width: 20px; height: 20px;}
        .submit-btn {background: var(--primary); color: #ffffff; padding: 10px 20px; border: none; border-radius: 8px; font-size: 16px; font-weight: 500; cursor: pointer; transition: background 0.2s ease, transform 0.2s ease; width: 100%; margin-top: 12px;}
        .submit-btn:hover {background: var(--hover); transform: translateY(-2px);}
        .modal {display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); justify-content: center; align-items: center; z-index: 1100;}
        .modal-content {background: #ffffff; padding: 16px; border-radius: 12px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 8px 32px rgba(0,0,0,0.3);}
        .modal.show .modal-content {transform: translateY(0); opacity: 1;}
        .modal .modal-content {transform: translateY(-20px); opacity: 0; transition: transform 0.3s ease, opacity 0.3s ease;}
        .modal-header {display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ccc; padding-bottom: 8px;}
        .modal-title {font-size: 24px; font-weight: 600; color: #333; text-transform: uppercase;}
        .close-btn, .airport-btn, .custom-btn {background: var(--primary); border: none; padding: 8px; border-radius: 8px; color: #fff; cursor: pointer; width: 100%; text-align: left; font-size: 14px; transition: background 0.2s ease;}
        .close-btn {width: auto;}
        .close-btn:hover, .airport-btn:hover, .custom-btn:hover {background: var(--hover);}
        .suggestion-list {position: absolute; top: 100%; left: 0; width: calc(100% - 40px); background: #f5f5f5; border: 1px solid #ccc; border-radius: 8px; max-height: 150px; overflow-y: auto; z-index: 1200; display: none; box-shadow: 0 4px 16px rgba(0,0,0,0.3);}
        .suggestion-item {padding: 8px; cursor: pointer; color: #333;}
        .suggestion-item:hover {background: var(--primary); color: #fff;}
        .loading-div {display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); justify-content: center; align-items: center; z-index: 1200;}
        .loader {border: 6px solid #f5f5f5; border-top: 6px solid var(--primary); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite;}
        @keyframes spin {0% {transform: rotate(0deg);} 100% {transform: rotate(360deg);}}
        .error-message {color: #9d2626; font-size: 12px; display: none; margin-top: 4px;}
        .via-field .field-container {display: flex; align-items: center;}
        .via-field input {flex: 1; margin-right: 8px;}
        .via-field .suggestion-list {width: calc(100% - 48px);}
        .remove-field {background: var(--primary); color: #fff; border: none; padding: 8px 10px; font-size: 16px; border-radius: 8px; cursor: pointer;}
        .remove-field:hover {background: var(--hover);}
        .items-side-menu {position: absolute; top: 0; right: 0; width: 250px; background: #fff; border-radius: 12px 0 0 12px; box-shadow: -4px 0 16px rgba(0,0,0,0.3); transform: translateX(100%); transition: transform 0.3s ease; z-index: 1000; display: none; flex-direction: column; padding: 16px;}
        .items-side-menu.show {transform: translateX(0); display: flex;}
        .items-side-menu-item {display: flex; justify-content: space-between; padding: 8px; border: 1px solid #ccc; border-radius: 8px; background: #f5f5f5; margin-bottom: 8px;}
        .delete-btn img {width: 16px; height: 16px; padding: 3px; background: #555; border-radius: 4px;}
        .download-icons img {width: 46px; height: 46px; filter: drop-shadow(3px 3px 10px #9e9e9e); cursor: pointer;}
        .download-icons {display: flex; gap: 10px; justify-content: center; margin-bottom: 10px;}
        .divider {width: 1px; height: 40px; background: #555; margin: 0 10px;}
        @media (max-width: 768px) {.two-column {grid-template-columns: 1fr;} .items-side-menu {width: 65%; border-radius: 0;}}
    </style>
</head>
<body>

<!-- EMBEDDABLE WIDGET - USERS PASTE THIS ON THEIR SITE -->
<div class="london-taxi-widget"
     data-domain="londontaxis247.co.uk"
     data-office="LNT"
     data-name="Cheap Airport Transfers London"
     data-url="https://cheapairporttransferslondon.com/"
     data-phone="02037405467"
     data-color="111d13">
</div>

<script>
// AUTO-INJECT FULL DYNAMIC WIDGET
(function () {
    const widgets = document.querySelectorAll('.london-taxi-widget');
    widgets.forEach(widget => {
        const DOMAIN = widget.dataset.domain || 'londontaxis247.co.uk';
        const OFFICE = widget.dataset.office || 'LNT';
        const NAME   = widget.dataset.name   || 'London Airport Transfers';
        const URL    = widget.dataset.url    || 'https://londonairporttransfers.com/';
        const PHONE  = widget.dataset.phone  || '02037405467';
        const COLOR  = widget.dataset.color  || '111d13';

        const OFFICE_DETAILS = `${OFFICE},${NAME},${URL},${PHONE}`;
        document.documentElement.style.setProperty('--primary', `#${COLOR}`);
        document.documentElement.style.setProperty('--hover',   `#${COLOR}cc`);

        widget.innerHTML = `
<div class="form-container">
    <h3 class="form-title">London Airport Minicab</h3>
    <div class="download-icons">
        <img src="images/googleplay.png" alt="Google Play">
        <hr class="divider">
        <img src="images/applestore.png" alt="App Store">
        <hr class="divider">
        <img src="images/call.png" alt="Call">
    </div>
    <p style="text-align:center;">OR</p>

    <div class="form-field">
        <label class="field-label">Pick Up</label>
        <div class="field-container">
            <input id="pickup" class="custom-input" placeholder="Select pickup address" autocomplete="off">
            <div id="pickup-suggestions" class="suggestion-list"></div>
            <button class="icon-btn" onclick="openModal('airportListModal1')"><img src="images/aeroplane.png"></button>
        </div>
        <span class="error-message" id="pickup-error">Please select a valid pickup address.</span>
    </div>

    <div class="form-field" id="via-section">
        <label class="field-label">Via <img id="via-plus" src="images/plus1.webp" onclick="addViaField()" class="disabled"></label>
        <div id="via-list"></div>
    </div>

    <div class="form-field">
        <label class="field-label">Destination</label>
        <div class="field-container">
            <input id="dropof" class="custom-input" placeholder="Select dropoff address" autocomplete="off">
            <div id="dropof-suggestions" class="suggestion-list"></div>
            <button class="icon-btn" onclick="openModal('airportListModal2')"><img src="images/aeroplane.png"></button>
        </div>
        <span class="error-message" id="dropof-error">Please select a valid dropoff address.</span>
    </div>

    <div class="two-column">
        <div class="form-field">
            <label class="field-label">Wait Time (min)</label>
            <div class="field-container field-mini">
                <label class="toggle-switch"><input type="checkbox" id="wait_time_toggle" onchange="toggleWaitTime()"><span class="slider"></span></label>
                <input id="wait_time" class="wait-time-input" type="number" min="0" max="60" value="0" disabled>
            </div>
        </div>
        <div class="form-field">
            <label class="field-label">DateTime</label>
            <input id="book_pick_datetime" class="custom-datetime" type="datetime-local">
        </div>
    </div>

    <div class="two-column">
        <div class="form-field">
            <label class="field-label">Passenger</label>
            <div class="field-container field-mini">
                <button class="icon-btn"><img src="images/people.webp"></button>
                <input type="number" id="Passenger" class="custom-input" min="1" max="200" value="1">
            </div>
        </div>
        <div class="form-field">
            <label class="field-label">Items</label>
            <div class="field-container field-mini">
                <button class="icon-btn" onclick="openModal('moreModalitem')"><img src="images/luggage-form.webp"></button>
                <input id="items-input" class="custom-input" value="No Items" readonly onclick="toggleItemsSideMenu()">
            </div>
        </div>
    </div>

    <div id="items-side-menu" class="items-side-menu">
        <div style="display:flex; justify-content:space-between; border-bottom:1px solid #ddd; padding-bottom:10px;">
            <h3>Selected Items</h3>
            <button class="custom-btn" style="width:auto;padding:8px 16px;" onclick="toggleItemsSideMenu()">Close</button>
        </div>
        <div id="items-side-menu-body" style="flex:1; overflow-y:auto; margin:15px 0;"></div>
        <button class="custom-btn" onclick="clearAllItems()">Clear All</button>
    </div>

    <button class="submit-btn" onclick="submitForm()">Get Quotes</button>
</div>

<!-- MODALS (Airports + Items) -->
<div id="airportListModal1" class="modal"><div class="modal-content"> ... (same airport list) ... </div></div>
<div id="airportListModal2" class="modal"><div class="modal-content"> ... (same airport list) ... </div></div>
<div id="moreModalitem" class="modal"><div class="modal-content"><h2>Select More Items</h2><div id="accordionExample"></div><div class="loader" id="sploader" style="display:none;"></div></div></div>
<div id="itemcount" class="modal"><div class="modal-content"><h2>Enter Quantity</h2><input type="hidden" id="nameid"><input type="number" id="numbermoreitm" class="custom-input" min="1" max="99" value="1"><button class="custom-btn" onclick="addItem()">Save</button></div></div>
<div class="loading-div"><div class="loader"></div></div>
        `;

        const script = document.createElement('script');
        script.text = `
            const API_BASE = "https://${DOMAIN}";
            const OFFICE_DETAILS = "${OFFICE_DETAILS}";
            const COLOR_CODE = "${COLOR}";

            let originalFields = [], validAddresses = [], accuserdb = "";

            function openModal(id) { const m = document.getElementById(id); m.classList.add("show"); m.style.display = "flex"; }
            function closeModal(id) { const m = document.getElementById(id); m.classList.remove("show"); setTimeout(() => { m.style.display = "none"; if(id==="moreModalitem") document.querySelectorAll(".collapse.show").forEach(c=>c.classList.remove("show")); }, 300); }

            function setDefaultDateTime() {
                const now = new Date(); now.setMinutes(now.getMinutes() + 15);
                document.getElementById("book_pick_datetime").value = now.toISOString().slice(0,16);
            }

            function toggleWaitTime() {
                const t = document.getElementById("wait_time_toggle").checked;
                const i = document.getElementById("wait_time");
                i.disabled = !t; i.value = t ? 30 : 0;
            }

            function debounce(func, delay) { let timer; return (...args) => { clearTimeout(timer); timer = setTimeout(() => func(...args), delay); }; }

            async function fetchSuggestions(query, listId) {
                if (query.length < 3) { document.getElementById(listId).style.display = "none"; return []; }
                const res = await fetch(\`\${API_BASE}/Home/Indextwo?Prefix=\${encodeURIComponent(query)}\`);
                const data = await res.json();
                const list = document.getElementById(listId);
                list.innerHTML = (data.list || []).map(a => \`<div class="suggestion-item" onclick="selectSuggestion('\${a.address}', '\${listId.replace("-suggestions","")}')">\${a.address}</div>\`).join("");
                list.style.display = data.list?.length ? "block" : "none";
                return data.list || [];
            }

            function selectSuggestion(addr, fieldId) {
                document.getElementById(fieldId).value = addr;
                validAddresses.push(addr);
                document.getElementById(fieldId + "-suggestions").style.display = "none";
            }

            // ... [ALL YOUR ORIGINAL FUNCTIONS: addViaField, renderViaFields, loadItems, submitForm, etc.] ...

            async function submitForm() {
                const pickup = document.getElementById("pickup").value.trim();
                const dropoff = document.getElementById("dropof").value.trim();
                const datetime = document.getElementById("book_pick_datetime").value;
                const passengers = +document.getElementById("Passenger").value || 1;
                const waitTime = document.getElementById("wait_time_toggle").checked ? +document.getElementById("wait_time").value : 0;
                const tripFlag = waitTime > 0 ? "WR" : "single";
                const vias = originalFields.map(v => v.trim()).filter(Boolean).join("@");
                const luggageText = accuserdb || "";

                if (!pickup || !dropoff || !datetime) { alert("Please fill all required fields"); return; }

                const url = \`https://${DOMAIN}/OurVehicle/OurVehicle?pickup=\${encodeURIComponent(pickup)}&dropoff=\${encodeURIComponent(dropoff)}&office_details=\${encodeURIComponent(OFFICE_DETAILS)}&listviasaddress=\${encodeURIComponent(vias)}&tripFlag=\${tripFlag}&mints=\${waitTime}&colorCode=\${COLOR_CODE}&luggage_text=\${encodeURIComponent(luggageText)}\`;

                document.querySelector(".loading-div").style.display = "flex";
                window.location.href = url;
            }

            document.addEventListener("DOMContentLoaded", () => {
                setDefaultDateTime();
                document.getElementById("pickup").addEventListener("input", debounce(e => fetchSuggestions(e.target.value, "pickup-suggestions"), 300));
                document.getElementById("dropof").addEventListener("input", debounce(e => fetchSuggestions(e.target.value, "dropof-suggestions"), 300));
                document.querySelectorAll(".airport-btn").forEach(btn => {
                    btn.onclick = () => {
                        const field = btn.closest(".modal").id.includes("1") ? "pickup" : "dropof";
                        document.getElementById(field).value = btn.dataset.value;
                        validAddresses.push(btn.dataset.value);
                        closeModal(btn.closest(".modal").id);
                    };
                });
            });
        `;
        widget.appendChild(script);
    });
})();
</script>

</body>
</html>
